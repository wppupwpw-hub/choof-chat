<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إعداد ربط فيسبوك ماسنجر</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">
                        <i class="fab fa-facebook-messenger me-3"></i>
                        دليل ربط فيسبوك ماسنجر
                    </h3>
                </div>
                
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>الشات بوت جاهز للربط مع فيسبوك!</strong> 
                        اتبع هذه الخطوات بالترتيب لربطه بصفحة فيسبوك الخاصة بك.
                    </div>

                    <!-- Step 1: Create Facebook App -->
                    <div class="step-section mb-4">
                        <h4 class="text-primary">
                            <span class="badge bg-primary me-2">1</span>
                            إنشاء تطبيق فيسبوك
                        </h4>
                        <div class="card">
                            <div class="card-body">
                                <ol>
                                    <li>اذهب إلى <a href="https://developers.facebook.com/apps/" target="_blank" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-external-link-alt me-1"></i>
                                        مطوري فيسبوك
                                    </a></li>
                                    <li>انقر "إنشاء تطبيق" (Create App)</li>
                                    <li>اختر "أعمال" (Business)</li>
                                    <li>املأ تفاصيل التطبيق</li>
                                    <li>أضف منتج "ماسنجر" (Messenger) إلى تطبيقك</li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Webhook Configuration -->
                    <div class="step-section mb-4">
                        <h4 class="text-primary">
                            <span class="badge bg-primary me-2">2</span>
                            إعداد الـ Webhook
                        </h4>
                        <div class="card">
                            <div class="card-body">
                                <p>في إعدادات ماسنجر في تطبيقك، أضف webhook جديد بهذه البيانات:</p>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">رابط الـ Webhook URL:</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" value="{{ webhook_url }}" readonly id="webhook-url">
                                            <button class="btn btn-outline-secondary" onclick="copyToClipboard('webhook-url')">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                        <small class="text-muted">انسخ هذا الرابط والصقه في إعدادات الـ webhook</small>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">رمز التحقق (Verify Token):</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" value="my_verify_token_123" readonly id="verify-token">
                                            <button class="btn btn-outline-secondary" onclick="copyToClipboard('verify-token')">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                        <small class="text-muted">استخدم هذا الرمز أو ضع رمز مخصص لك</small>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <label class="form-label fw-bold">حقول الاشتراك (Subscription Fields):</label>
                                    <div class="d-flex flex-wrap gap-2">
                                        <span class="badge bg-secondary">messages</span>
                                        <span class="badge bg-secondary">messaging_postbacks</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Page Access Token -->
                    <div class="step-section mb-4">
                        <h4 class="text-primary">
                            <span class="badge bg-primary me-2">3</span>
                            الحصول على Page Access Token
                        </h4>
                        <div class="card">
                            <div class="card-body">
                                <ol>
                                    <li>في صفحة إعدادات ماسنجر، اختر صفحة فيسبوك الخاصة بك</li>
                                    <li>انقر "Generate Token" لإنشاء رمز وصول الصفحة</li>
                                    <li>انسخ الرمز المُنشأ (Page Access Token)</li>
                                    <li>احفظ هذا الرمز - ستحتاجه في الخطوة التالية</li>
                                </ol>
                                
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>مهم:</strong> احتفظ بـ Page Access Token في مكان آمن. لا تشاركه مع أحد.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Environment Variables -->
                    <div class="step-section mb-4">
                        <h4 class="text-primary">
                            <span class="badge bg-primary me-2">4</span>
                            إعداد متغيرات البيئة
                        </h4>
                        <div class="card">
                            <div class="card-body">
                                <p>في إعدادات النشر (Deployment)، أضف هذه المتغيرات:</p>
                                
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead class="table-light">
                                            <tr>
                                                <th>اسم المتغير</th>
                                                <th>القيمة</th>
                                                <th>الوصف</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><code>FACEBOOK_APP_SECRET</code></td>
                                                <td>احصل عليه من إعدادات التطبيق → أساسي</td>
                                                <td>سر التطبيق</td>
                                            </tr>
                                            <tr>
                                                <td><code>FACEBOOK_VERIFY_TOKEN</code></td>
                                                <td><code>my_verify_token_123</code></td>
                                                <td>نفس الرمز المستخدم في الـ webhook</td>
                                            </tr>
                                            <tr>
                                                <td><code>FACEBOOK_PAGE_ACCESS_TOKEN</code></td>
                                                <td>الرمز الذي حصلت عليه في الخطوة 3</td>
                                                <td>رمز وصول الصفحة</td>
                                            </tr>
                                            <tr>
                                                <td><code>SESSION_SECRET</code></td>
                                                <td>أي نص عشوائي طويل</td>
                                                <td>لتأمين الجلسات</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 5: Test -->
                    <div class="step-section mb-4">
                        <h4 class="text-primary">
                            <span class="badge bg-primary me-2">5</span>
                            اختبار الربط
                        </h4>
                        <div class="card">
                            <div class="card-body">
                                <ol>
                                    <li>احفظ إعدادات الـ webhook في لوحة تحكم فيسبوك</li>
                                    <li>ارجع إلى <a href="/" class="btn btn-sm btn-outline-primary">الصفحة الرئيسية</a> وانقر "اختبار الرابط"</li>
                                    <li>أرسل رسالة إلى صفحة فيسبوك الخاصة بك لاختبار البوت</li>
                                </ol>
                                
                                <div class="alert alert-success">
                                    <i class="fas fa-check-circle me-2"></i>
                                    <strong>مبروك!</strong> بعد إكمال هذه الخطوات، سيعمل البوت تلقائياً مع صفحة فيسبوك الخاصة بك.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Links -->
                    <div class="text-center mt-4">
                        <a href="/" class="btn btn-primary me-2">
                            <i class="fas fa-arrow-left me-1"></i>
                            العودة للشات بوت
                        </a>
                        <a href="https://developers.facebook.com/docs/messenger-platform/" target="_blank" class="btn btn-outline-info">
                            <i class="fas fa-book me-1"></i>
                            وثائق فيسبوك
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    element.select();
    element.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(element.value);
    
    // Show feedback
    const button = element.nextElementSibling;
    const originalHTML = button.innerHTML;
    button.innerHTML = '<i class="fas fa-check"></i>';
    button.classList.add('btn-success');
    button.classList.remove('btn-outline-secondary');
    
    setTimeout(() => {
        button.innerHTML = originalHTML;
        button.classList.remove('btn-success');
        button.classList.add('btn-outline-secondary');
    }, 2000);
}
</script>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>